import React, { useEffect } from 'react';
import { Marker, Popup, useMap } from 'react-leaflet'

import _ from 'lodash'

import '../styles/css/marker_body.css'

import disRelTram from '../json/distances/Afstand tram_metro - religie.json'
import disRelEat from '../json/distances/Afstand eet_drink - religie.json'

export const MarkerBody = (props) => {
    const map = useMap()
    return(
        <section>
            {props.object.features.map((p, i) => (
                <Marker key={i}
                        position={[p.properties.LAT || p.properties.coordinates_y || p.properties.latitude, p.properties.LNG || p.properties.coordinates_x || p.properties.longitude]} icon={props.icon} eventHandlers={{ click: (e) => {
                        map.setView([p.properties.LAT || p.properties.coordinates_y || p.properties.latitude, p.properties.LNG || p.properties.coordinates_x || p.properties.longitude], 20);
                    } }}>
                        <Popup className="popup">
                            <section className="popup__body">
                                <h2>{p.properties.title || p.properties.Project || p.properties.Titel_kunstwerk || p.properties.TITEL || p.properties.display_naam || p.properties.Naam ? p.properties.title || p.properties.Project || p.properties.Titel_kunstwerk || p.properties.TITEL || p.properties.display_naam || p.properties.Naam : "Naam Onbekend"}</h2>
                                
                                {/* Adressen */}
                                <section className='adres'>
                                    <section>
                                        <p>{p.properties.Adres}</p>
                                        <p>{p.properties.Adres_gebouw}</p>
                                        <p>{p.properties.adress}</p>
                                        <p>{p.properties.STRAATNAAM}</p>
                                    </section>
                                    <section>
                                        <p>{p.properties.zipcode}</p>
                                    </section>
                                </section>
                                
                                <section>
                                    {p.properties.Kunstenaar || p.properties.NAAM_KUNSTENAAR ?
                                        <p>Kunstenaar: {p.properties.Kunstenaar || p.properties.NAAM_KUNSTENAAR}</p>
                                    : null}
                                    {p.properties.Architect ? <p>Architect: {p.properties.Architect}</p> : null}
                                    {p.properties.Bouwjaar || p.properties.JAAR_VAN_PLAATSING || p.properties.Jaar ?
                                    <p>Bouwjaar: {p.properties.Bouwjaar || p.properties.JAAR_VAN_PLAATSING || p.properties.Jaar}</p>
                                    : null}
                                    {p.properties.Modaliteit ? p.properties.Lijn ? <p>{p.properties.Modaliteit} - {p.properties.Lijn}</p> : null : null}
                                    
                                </section>
                                
                                {/* Beschrijvingen */}
                                {p.properties.Info || p.properties.OMSCHRIJVING || p.properties.short_description_nl || p.properties.Kunsthistorische_waarde || p.properties.Cultuurhistorische_waarde ?
                                <section className='info'>
                                    <h2>Informatie</h2>
                                    <section className="info__body">
                                        <p>{p.properties.Info}</p>
                                        <p>{p.properties.OMSCHRIJVING}</p>
                                        <p>{p.properties.short_description_nl}</p>
                                        <p>{p.properties.Kunsthistorische_waarde}</p>
                                        <br></br>
                                        <p>{p.properties.Cultuurhistorische_waarde}</p>
                                    </section>
                                </section>
                                : null}
                                

                                {/* Links */}
                                {p.properties.url ? <a href={p.properties.url}>Website</a> : null}
                                {p.properties.HYPERLINK ? <a href={p.properties.HYPERLINK}>Website</a> : null}

                                {p.properties.calendar_summary_nl ? 
                                <section className='tijden'>
                                    <h2>Openingstijden</h2>
                                    <p>{p.properties.calendar_summary_nl}</p>
                                </section>
                                : null }

                                <button className='btn' onClick={() => {props.addLoc({"name": p.properties.title || p.properties.Project || p.properties.Titel_kunstwerk || p.properties.TITEL || p.properties.display_naam || p.properties.Naam ? p.properties.title || p.properties.Project || p.properties.Titel_kunstwerk || p.properties.TITEL || p.properties.display_naam || p.properties.Naam : "Naam Onbekend", "latlng": [p.properties.LAT || p.properties.coordinates_y || p.properties.latitude, p.properties.LNG || p.properties.coordinates_x || p.properties.longitude]})}}>Add to Route</button>
                            </section>
                        </Popup>
                    </Marker>
            ))}
        </section>
    )
}

export const MarkerBodyAlt = (props) => {
    const map = useMap()

    // const getClosest = (name) =>{
    //     let result = disRelTram.features.filter(obj => obj.properties.TargetID === name && obj.properties.Distance <= 200)
    //     return result;
    // }

    // const getClosest2 = (name) =>{
    //     let result = disRelEat.features.filter(obj => obj.properties.TargetID === name && obj.properties.Distance <= 200)
    //     return result;
    // }
    // useEffect(() => {
    //     getClosest('Koninkrijkszaal');
    // })

    return(
        <section>
            {props.object.map((p, i) => (
                <Marker key={i}
                        position={[p.properties.LAT, p.properties.LNG]} icon={props.icon} eventHandlers={{ click: (e) => {
                        map.setView([p.properties.LAT, p.properties.LNG], 20);
                    } }}>
                        <Popup>
                            <section>
                                <h2>{p.properties.Gebouwnaam}</h2>
                                <section className='adres geloof'>
                                    <p>{p.properties.Adres}</p>
                                </section>
                                
                                <section className='info geloof'>
                                    <h2>Gebouw Informatie</h2>
                                    <p>Type gebouw: {p.properties.Gebouwtype != null ? p.properties.Gebouwtype : "Onbekend"}</p>
                                    <p>Genootschap: {p.properties.Genootschap != null ? p.properties.Genootschap : "Niet aangesloten"}</p>
                                    <p>Gebruik: {p.properties.Categorie}</p>
                                </section>
                                <br></br>
                                {p.properties.Website != null ? <a href={p.properties.Website}>Website</a> : null}

                                {/* {getClosest(p.properties.Gebouwnaam).map((c, i) => (
                                    <p key={i}>{c.properties.InputID}</p>
                                ))} */}

                                {/* {getClosest2(p.properties.Gebouwnaam).map((c, i) => (
                                    <p key={i}>{c.properties.InputID}</p>
                                ))} */}
                                <button className='btn' onClick={() => {props.addLoc({"name": p.properties.Gebouwnaam, "latlng": [p.properties.LAT, p.properties.LNG]})}}>Add to Route</button>
                            </section>
                        </Popup>
                    </Marker>
            ))}
        </section>
    )
}